{% extends 'dashboard/master.html' %}
{% load svg %}
{% block content %}
    <div class="db-heading">
        <div class="breadcrums db-breadcrums">
            <a href="/administracion" class="breadcrums__link">Dashboard</a>
            <span class="breadcrums__chevron">{% svg 'chevron-right' %}</span>
            <a href="/administracion" class="breadcrums__link">Tickets</a>
            <span class="breadcrums__chevron">{% svg 'chevron-right' %}</span>
            <a class="breadcrums__link breadcrums__link--active">Bandeja</a>
        </div>
        <h1 class="db-heading__title">Bandeja de tickets</h1>
    </div>

    <section class="section mb-16">
        <div class="fluid-container">
            <tabs-component class="tabs--sm"
                :breakpoint="1160"
                :tabs="{{ statuses }}"
                :options="{{ statuses }}"
                :accepts-html="true"
            >
                {% for key, requests in requestByStatus.items %}
                    <template slot="panel-{{ key }}">
                        <div class="row">
                            {% for element in requests.solicitudes %}
                                <a class="card-request card-request__link" href="{% url 'dashboard:solicitud' element.folio %}">
                                    <div>
                                        <div class="card-request__header card-request__header--folio">
                                            <span class="card-request__badge" style="{{element.area|colorArea}}">{%if element.area == Nobne%}INFRAESTRUCTURA{%else%}{{element.area}}{%endif%}</span>                                                
                                            <div class="card-request__service-container">
                                                {% for subservicio in element.subservices %}
                                                    {% if subservicio.estatus_key_name == 'concluido' %}
                                                        <span class="card-request__service card-request__service--{{ subservicio.servicio | slugify }}-active"></span>
                                                    {% else %}
                                                        <span class="card-request__service card-request__service--{{ subservicio.servicio | slugify }}"></span>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>  
                                            {% if element.titulo %}
                                                <p class="card-request__title">{{ element.titulo }}</p>
                                            {% endif %}
                                            <p class="card-request__date">{{ element.formatted_date }}.</p>
                                            <dl class="list-inline list-inline--md">
                                                <dt class="card-request__dt-title">Enviada por</dt>
                                                <dd>
                                                    <span class="card-request__dd-user">{{ element.nombre }} {{ element.apellido_paterno }}{% if element.apellido_materno %} {{ element.apellido_materno }}{% endif %}</span>
                                                    <br><span class="card-request__dd-ures">{{ element.ures_desc }}</span>
                                                </dd>
                                                <dt class="card-request__dt-title">Descripción</dt>
                                                <dd class="card-request__dd-description">{{ element.descripcion | truncatewords:25 }}</dd>
                                                {% if element.count_files != 0 %}
                                                    <div class="card-request__attach">
                                                        <span class="card-request__attach-icon">{% svg 'paperclip' %}</span>
                                                        <span class="card-request__attach-number">{{ element.count_files }}</span>
                                                    </div>
                                                {% endif %}
                                            </dl>
                                    </div>
                                    <div class="card-request__footer2" >
                                        <span class="card-request__folio"><b>FOLIO: {{ element.folio }} </b></span>
                                    </div>
                                </a>
                            {% endfor %}
                        </div>

                        <div class="pagination">
                            {% if requests.paginator.has_previous %}
                                <a href="?page_{{ key }}=1" class="pagination__button">&laquo;&laquo;</a>
                                <a href="?page_{{ key }}={{ requests.paginator.previous_page_number }}" class="pagination__button">&laquo;</a>
                            {% endif %}
                        
                            <span class="pagination__current-page">
                                Página <strong>{{ requests.paginator.number }}</strong> de {{ requests.paginator.paginator.num_pages }}
                            </span>
                        
                            {% if requests.paginator.has_next %}
                                <a href="?page_{{ key }}={{ requests.paginator.next_page_number }}" class="pagination__button">&raquo;</a>
                                <a href="?page_{{ key }}={{ requests.paginator.paginator.num_pages }}" class="pagination__button">&raquo;&raquo;</a>
                            {% endif %}
                        </div>
                        
                        
                        
                    </template>
                {% endfor %}
            </tabs-component>
        </div>
    </section>
{% endblock %}
